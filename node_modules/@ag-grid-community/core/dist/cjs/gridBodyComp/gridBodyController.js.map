{"version":3,"sources":["../../src/ts/gridBodyComp/gridBodyController.ts"],"names":[],"mappings":"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","file":"gridBodyController.js","sourcesContent":["import { BeanStub } from \"../context/beanStub\";\nimport { Autowired, Optional } from \"../context/context\";\nimport { LayoutFeature, LayoutView } from \"../styling/layoutFeature\";\nimport { Constants } from \"../constants/constants\";\nimport { Events } from \"../eventKeys\";\nimport { RowContainerHeightService } from \"../rendering/rowContainerHeightService\";\nimport { ControllersService } from \"../controllersService\";\nimport { ColumnController } from \"../columnController/columnController\";\nimport { ScrollVisibleService } from \"./scrollVisibleService\";\nimport { getTarget } from \"../utils/event\";\nimport { IContextMenuFactory } from \"../interfaces/iContextMenuFactory\";\nimport { GridBodyScrollFeature } from \"./gridBodyScrollFeature\";\nimport { getInnerWidth, isVerticalScrollShowing } from \"../utils/dom\";\nimport { HeaderNavigationService } from \"../headerRendering/header/headerNavigationService\";\nimport { PaginationProxy } from \"../pagination/paginationProxy\";\nimport { RowDragFeature } from \"./rowDragFeature\";\nimport { DragAndDropService } from \"../dragAndDrop/dragAndDropService\";\nimport { PinnedRowModel } from \"../pinnedRowModel/pinnedRowModel\";\nimport { getTabIndex, isBrowserIE } from \"../utils/browser\";\nimport { RowRenderer } from \"../rendering/rowRenderer\";\nimport { PopupService } from \"../widgets/popupService\";\nimport { MouseEventService } from \"./mouseEventService\";\n\nexport enum RowAnimationCssClasses {\n    ANIMATION_ON = 'ag-row-animation',\n    ANIMATION_OFF = 'ag-row-no-animation'\n}\n\nexport const CSS_CLASS_CELL_SELECTABLE = 'ag-selectable';\nexport const CSS_CLASS_FORCE_VERTICAL_SCROLL = 'ag-force-vertical-scroll';\nexport const CSS_CLASS_COLUMN_MOVING = 'ag-column-moving';\n\nexport interface GridBodyView extends LayoutView {\n    setColumnMovingCss(selectable: boolean): void;\n    setCellSelectableCss(selectable: boolean): void;\n    setTopHeight(height: number): void;\n    setTopDisplay(display: string): void;\n    setBottomHeight(height: number): void;\n    setBottomDisplay(display: string): void;\n    setColumnCount(count: number): void;\n    setRowCount(count: number): void;\n    setRowAnimationCssOnBodyViewport(animate: boolean): void;\n    setAlwaysVerticalScrollClass(on: boolean): void;\n    setVerticalScrollPaddingVisible(visible: boolean): void;\n    registerBodyViewportResizeListener(listener: (() => void)): void;\n}\n\nexport class GridBodyController extends BeanStub {\n\n    @Autowired('rowContainerHeightService') private rowContainerHeightService: RowContainerHeightService;\n    @Autowired('controllersService') private controllersService: ControllersService;\n    @Autowired('columnController') private columnController: ColumnController;\n    @Autowired('scrollVisibleService') private scrollVisibleService: ScrollVisibleService;\n    @Optional('contextMenuFactory') private contextMenuFactory: IContextMenuFactory;\n    @Autowired('headerNavigationService') private headerNavigationService: HeaderNavigationService;\n    @Autowired('paginationProxy') private paginationProxy: PaginationProxy;\n    @Autowired('dragAndDropService') private dragAndDropService: DragAndDropService;\n    @Autowired('pinnedRowModel') private pinnedRowModel: PinnedRowModel;\n    @Autowired('rowRenderer') private rowRenderer: RowRenderer;\n    @Autowired('popupService') public popupService: PopupService;\n    @Autowired('mouseEventService') public mouseEventService: MouseEventService;\n\n    private view: GridBodyView;\n    private eGridBody: HTMLElement;\n    private eBodyViewport: HTMLElement;\n    private eTop: HTMLElement;\n    private eBottom: HTMLElement;\n\n    private bodyScrollFeature: GridBodyScrollFeature;\n    private rowDragFeature: RowDragFeature;\n\n    public getScrollFeature(): GridBodyScrollFeature {\n        return this.bodyScrollFeature;\n    }\n\n    public getBodyViewportElement(): HTMLElement {\n        return this.eBodyViewport;\n    }\n\n    public setView(view: GridBodyView, eGridBody: HTMLElement, eBodyViewport: HTMLElement,\n                   eTop: HTMLElement, eBottom: HTMLElement): void {\n        this.view = view;\n        this.eGridBody = eGridBody;\n        this.eBodyViewport = eBodyViewport;\n        this.eTop = eTop;\n        this.eBottom = eBottom;\n\n        this.setCellTextSelection(this.gridOptionsWrapper.isEnableCellTextSelect());\n\n        this.createManagedBean(new LayoutFeature(this.view));\n        this.bodyScrollFeature = this.createManagedBean(new GridBodyScrollFeature(this.eBodyViewport));\n        this.addRowDragListener();\n\n        this.setupRowAnimationCssClass();\n\n        this.controllersService.registerGridBodyController(this);\n\n        this.addEventListeners();\n        this.onGridColumnsChanged();\n        this.addBodyViewportListener();\n        this.setFloatingHeights();\n        this.disableBrowserDragging();\n        this.addStopEditingWhenGridLosesFocus();\n    }\n\n    private addEventListeners(): void {\n        this.addManagedListener(this.eventService, Events.EVENT_GRID_COLUMNS_CHANGED, this.onGridColumnsChanged.bind(this));\n        this.addManagedListener(this.eventService, Events.EVENT_SCROLL_VISIBILITY_CHANGED, this.onScrollVisibilityChanged.bind(this));\n        this.addManagedListener(this.eventService, Events.EVENT_PINNED_ROW_DATA_CHANGED, this.setFloatingHeights.bind(this));\n    }\n\n    // used by ColumnAnimationService\n    public setColumnMovingCss(moving: boolean): void {\n        this.view.setColumnMovingCss(moving);\n    }\n\n    public setCellTextSelection(selectable: boolean = false): void {\n        this.view.setCellSelectableCss(selectable);\n    }\n\n    private onScrollVisibilityChanged(): void {\n        const show = this.scrollVisibleService.isVerticalScrollShowing();\n        this.view.setVerticalScrollPaddingVisible(show);\n    }\n\n    private onGridColumnsChanged(): void {\n        const columns = this.columnController.getAllGridColumns();\n        this.view.setColumnCount(columns ? columns.length : 0);\n    }\n\n    // if we do not do this, then the user can select a pic in the grid (eg an image in a custom cell renderer)\n    // and then that will start the browser native drag n' drop, which messes up with our own drag and drop.\n    private disableBrowserDragging(): void {\n        this.addManagedListener(this.eGridBody, 'dragstart', (event: MouseEvent) => {\n            if (event.target instanceof HTMLImageElement) {\n                event.preventDefault();\n                return false;\n            }\n        });\n    }\n\n    private addStopEditingWhenGridLosesFocus(): void {\n        if (!this.gridOptionsWrapper.isStopEditingWhenCellsLoseFocus()) { return; }\n\n        const focusOutListener = (event: FocusEvent): void => {\n            // this is the element the focus is moving to\n            const elementWithFocus = event.relatedTarget as HTMLElement;\n\n            if (getTabIndex(elementWithFocus) === null) {\n                this.rowRenderer.stopEditing();\n                return;\n            }\n\n            let clickInsideGrid =\n                // see if click came from inside the viewports\n                viewports.some(viewport => viewport.contains(elementWithFocus))\n                // and also that it's not from a detail grid\n                && this.mouseEventService.isElementInThisGrid(elementWithFocus);\n\n            if (!clickInsideGrid) {\n                const popupService = this.popupService;\n\n                clickInsideGrid =\n                    popupService.getActivePopups().some(popup => popup.contains(elementWithFocus)) ||\n                    popupService.isElementWithinCustomPopup(elementWithFocus);\n            }\n\n            if (!clickInsideGrid) {\n                this.rowRenderer.stopEditing();\n            }\n        };\n\n        const viewports = [this.eBodyViewport, this.eBottom, this.eTop];\n\n        viewports.forEach(viewport => this.addManagedListener(viewport, 'focusout', focusOutListener));\n    }\n\n    public updateRowCount(): void {\n        const headerCount = this.headerNavigationService.getHeaderRowCount();\n        const modelType = this.paginationProxy.getType();\n        let rowCount = -1;\n\n        if (modelType === Constants.ROW_MODEL_TYPE_CLIENT_SIDE) {\n            rowCount = 0;\n            this.paginationProxy.forEachNode(node => {\n                if (!node.group) { rowCount++; }\n            });\n        }\n\n        const total = rowCount === -1 ? -1 : (headerCount + rowCount);\n\n        this.view.setRowCount(total);\n    }\n\n    public registerBodyViewportResizeListener(listener: (() => void)): void {\n        this.view.registerBodyViewportResizeListener(listener);\n    }\n\n    public setVerticalScrollPaddingVisible(visible: boolean): void {\n        this.view.setVerticalScrollPaddingVisible(visible);\n    }\n\n    public isVerticalScrollShowing(): boolean {\n        const isAlwaysShowVerticalScroll = this.gridOptionsWrapper.isAlwaysShowVerticalScroll();\n        this.view.setAlwaysVerticalScrollClass(isAlwaysShowVerticalScroll);\n        return isAlwaysShowVerticalScroll || isVerticalScrollShowing(this.eBodyViewport);\n    }\n\n    private setupRowAnimationCssClass(): void {\n        const listener = () => {\n            // we don't want to use row animation if scaling, as rows jump strangely as you scroll,\n            // when scaling and doing row animation.\n            const animateRows = this.gridOptionsWrapper.isAnimateRows() && !this.rowContainerHeightService.isStretching();\n            this.view.setRowAnimationCssOnBodyViewport(animateRows);\n        };\n\n        listener();\n\n        this.addManagedListener(this.eventService, Events.EVENT_HEIGHT_SCALE_CHANGED, listener);\n    }\n\n    public getGridBodyElement(): HTMLElement {\n        return this.eGridBody;\n    }\n\n    private addBodyViewportListener(): void {\n        // we want to listen for clicks directly on the eBodyViewport, so the user has a way of showing\n        // the context menu if no rows or columns are displayed, or user simply clicks outside of a cell\n        const listener = (mouseEvent: MouseEvent) => {\n            const target = getTarget(mouseEvent);\n            if (target === this.eBodyViewport || target === this.controllersService.getCenterRowContainerCon().getViewportElement()) {\n                // show it\n                if (this.contextMenuFactory) {\n                    this.contextMenuFactory.onContextMenu(mouseEvent, null, null, null, null, this.eGridBody);\n                }\n            }\n        };\n\n        this.addManagedListener(this.eBodyViewport, 'contextmenu', listener);\n    }\n\n    public getGui(): HTMLElement {\n        return this.eGridBody;\n    }\n\n    // called by rowDragFeature\n    public scrollVertically(pixels: number): number {\n        const oldScrollPosition = this.eBodyViewport.scrollTop;\n\n        this.bodyScrollFeature.setVerticalScrollPosition(oldScrollPosition + pixels);\n        return this.eBodyViewport.scrollTop - oldScrollPosition;\n    }\n\n    // + rangeController - used to know when to scroll when user is dragging outside the\n    // main viewport while doing a range selection\n    public getBodyClientRect(): ClientRect | undefined {\n        if (!this.eBodyViewport) { return; }\n\n        return this.eBodyViewport.getBoundingClientRect();\n    }\n\n    private addRowDragListener(): void {\n        this.rowDragFeature = this.createManagedBean(new RowDragFeature(this.eBodyViewport));\n        this.dragAndDropService.addDropTarget(this.rowDragFeature);\n    }\n\n    public getRowDragFeature(): RowDragFeature {\n        return this.rowDragFeature;\n    }\n\n    private setFloatingHeights(): void {\n        const { pinnedRowModel } = this;\n\n        let floatingTopHeight = pinnedRowModel.getPinnedTopTotalHeight();\n\n        if (floatingTopHeight) {\n            // adding 1px for cell bottom border\n            floatingTopHeight += 1;\n        }\n\n        let floatingBottomHeight = pinnedRowModel.getPinnedBottomTotalHeight();\n\n        if (floatingBottomHeight) {\n            // adding 1px for cell bottom border\n            floatingBottomHeight += 1;\n        }\n\n        this.view.setTopHeight(floatingTopHeight);\n        this.view.setBottomHeight(floatingBottomHeight);\n\n        this.view.setTopDisplay(floatingTopHeight ? 'inherit' : 'none');\n        this.view.setBottomDisplay(floatingBottomHeight ? 'inherit' : 'none');\n    }\n\n    // method will call itself if no available width. this covers if the grid\n    // isn't visible, but is just about to be visible.\n    public sizeColumnsToFit(nextTimeout?: number) {\n        // IE is different to the other browsers, it already removes the scroll width\n        // while calling window.getComputedStyle() (which is called by getInnerWidth())\n        const removeScrollWidth = this.isVerticalScrollShowing() && !isBrowserIE();\n        const scrollWidthToRemove = removeScrollWidth ? this.gridOptionsWrapper.getScrollbarWidth() : 0;\n        const bodyViewportWidth = getInnerWidth(this.eBodyViewport);\n        const availableWidth = bodyViewportWidth - scrollWidthToRemove;\n\n        if (availableWidth > 0) {\n            this.columnController.sizeColumnsToFit(availableWidth, \"sizeColumnsToFit\");\n            return;\n        }\n\n        if (nextTimeout === undefined) {\n            window.setTimeout(() => {\n                this.sizeColumnsToFit(100);\n            }, 0);\n        } else if (nextTimeout === 100) {\n            window.setTimeout(() => {\n                this.sizeColumnsToFit(500);\n            }, 100);\n        } else if (nextTimeout === 500) {\n            window.setTimeout(() => {\n                this.sizeColumnsToFit(-1);\n            }, 500);\n        } else {\n            console.warn('AG Grid: tried to call sizeColumnsToFit() but the grid is coming back with ' +\n                'zero width, maybe the grid is not visible yet on the screen?');\n        }\n    }\n}\n"]}