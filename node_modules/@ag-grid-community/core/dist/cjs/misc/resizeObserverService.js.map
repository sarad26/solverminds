{"version":3,"sources":["../../src/ts/misc/resizeObserverService.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,8CAA0C;AAC1C,gDAA+C;AAC/C,8CAA6C;AAC7C,oCAAyD;AAGzD;IAA2C,yCAAQ;IAAnD;;IAwDA,CAAC;IAtDU,6CAAa,GAApB,UAAqB,OAAoB,EAAE,QAAoB,EAAE,aAA0B;QAA1B,8BAAA,EAAA,kBAA0B;QACvF,gEAAgE;QAChE,IAAM,gBAAgB,GAAG,IAAI,CAAC,qBAAqB,EAAE,CAAC;QACtD,iEAAiE;QACjE,0EAA0E;QAC1E,IAAM,iBAAiB,GAAG,mBAAQ,CAAC,QAAQ,EAAE,aAAa,CAAC,CAAC;QAC5D,IAAM,wBAAwB,GAAG;YAC7B,IAAM,cAAc,GAAG,IAAK,MAAc,CAAC,cAAc,CAAC,iBAAiB,CAAC,CAAC;YAC7E,cAAc,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;YAChC,OAAO,cAAM,OAAA,cAAc,CAAC,UAAU,EAAE,EAA3B,CAA2B,CAAC;QAC7C,CAAC,CAAC;QAEF,IAAM,WAAW,GAAG;YAEhB,iFAAiF;YACjF,IAAI,aAAa,GAAG,iBAAW,CAAC,OAAO,CAAC,CAAC;YACzC,IAAI,cAAc,GAAG,kBAAY,CAAC,OAAO,CAAC,CAAC;YAE3C,4CAA4C;YAC5C,IAAI,OAAO,GAAG,IAAI,CAAC;YAEnB,IAAM,+BAA+B,GAAG;gBACpC,IAAI,OAAO,EAAE;oBAET,IAAM,QAAQ,GAAG,iBAAW,CAAC,OAAO,CAAC,CAAC;oBACtC,IAAM,SAAS,GAAG,kBAAY,CAAC,OAAO,CAAC,CAAC;oBAExC,IAAM,OAAO,GAAG,QAAQ,KAAK,aAAa,IAAI,SAAS,KAAK,cAAc,CAAC;oBAC3E,IAAI,OAAO,EAAE;wBACT,aAAa,GAAG,QAAQ,CAAC;wBACzB,cAAc,GAAG,SAAS,CAAC;wBAC3B,QAAQ,EAAE,CAAC;qBACd;oBAED,gBAAgB,CAAC,UAAU,CAAC,+BAA+B,EAAE,aAAa,CAAC,CAAC;iBAC/E;YACL,CAAC,CAAC;YAEF,+BAA+B,EAAE,CAAC;YAElC,wDAAwD;YACxD,OAAO,cAAM,OAAA,OAAO,GAAG,KAAK,EAAf,CAAe,CAAC;QACjC,CAAC,CAAC;QAEF,IAAM,cAAc,GAAG,IAAI,CAAC,kBAAkB,CAAC,+BAA+B,EAAE,CAAC;QACjF,IAAM,oBAAoB,GAAG,CAAC,CAAE,MAAc,CAAC,cAAc,CAAC;QAE9D,IAAI,oBAAoB,IAAI,CAAC,cAAc,EAAE;YACzC,OAAO,wBAAwB,EAAE,CAAC;SACrC;aAAM;YACH,OAAO,WAAW,EAAE,CAAC;SACxB;IACL,CAAC;IAtDQ,qBAAqB;QADjC,cAAI,CAAC,uBAAuB,CAAC;OACjB,qBAAqB,CAwDjC;IAAD,4BAAC;CAxDD,AAwDC,CAxD0C,mBAAQ,GAwDlD;AAxDY,sDAAqB","file":"resizeObserverService.js","sourcesContent":["import { Bean } from \"../context/context\";\nimport { BeanStub } from \"../context/beanStub\";\nimport { debounce } from \"../utils/function\";\nimport { offsetHeight, offsetWidth } from \"../utils/dom\";\n\n@Bean('resizeObserverService')\nexport class ResizeObserverService extends BeanStub {\n\n    public observeResize(element: HTMLElement, callback: () => void, debounceDelay: number = 50): () => void {\n        // put in variable, so available to usePolyfill() function below\n        const frameworkFactory = this.getFrameworkOverrides();\n        // this gets fired too often and might cause some relayout issues\n        // so we add a debounce to the callback here to avoid the flashing effect.\n        const debouncedCallback = debounce(callback, debounceDelay);\n        const useBrowserResizeObserver = () => {\n            const resizeObserver = new (window as any).ResizeObserver(debouncedCallback);\n            resizeObserver.observe(element);\n            return () => resizeObserver.disconnect();\n        };\n\n        const usePolyfill = () => {\n\n            // initialise to the current width and height, so first call will have no changes\n            let widthLastTime = offsetWidth(element);\n            let heightLastTime = offsetHeight(element);\n\n            // when finished, this gets turned to false.\n            let running = true;\n\n            const periodicallyCheckWidthAndHeight = () => {\n                if (running) {\n\n                    const newWidth = offsetWidth(element);\n                    const newHeight = offsetHeight(element);\n\n                    const changed = newWidth !== widthLastTime || newHeight !== heightLastTime;\n                    if (changed) {\n                        widthLastTime = newWidth;\n                        heightLastTime = newHeight;\n                        callback();\n                    }\n\n                    frameworkFactory.setTimeout(periodicallyCheckWidthAndHeight, debounceDelay);\n                }\n            };\n\n            periodicallyCheckWidthAndHeight();\n\n            // the callback function we return sets running to false\n            return () => running = false;\n        };\n\n        const suppressResize = this.gridOptionsWrapper.isSuppressBrowserResizeObserver();\n        const resizeObserverExists = !!(window as any).ResizeObserver;\n\n        if (resizeObserverExists && !suppressResize) {\n            return useBrowserResizeObserver();\n        } else {\n            return usePolyfill();\n        }\n    }\n\n}\n"]}