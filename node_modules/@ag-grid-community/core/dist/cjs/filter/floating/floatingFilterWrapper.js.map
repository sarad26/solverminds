{"version":3,"sources":["../../src/ts/filter/floating/floatingFilterWrapper.ts"],"names":[],"mappings":"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","file":"floatingFilterWrapper.js","sourcesContent":["import { Autowired } from '../../context/context';\nimport { IMenuFactory } from '../../interfaces/iMenuFactory';\nimport { Column } from '../../entities/column';\nimport { SetLeftFeature } from '../../rendering/features/setLeftFeature';\nimport { IFloatingFilterComp, IFloatingFilterParams } from './../floating/floatingFilter';\nimport { RefSelector } from '../../widgets/componentAnnotations';\nimport { HoverFeature } from '../../headerRendering/hoverFeature';\nimport { Events, FilterChangedEvent } from '../../events';\nimport { ColumnHoverService } from '../../rendering/columnHoverService';\nimport { AgPromise } from '../../utils';\nimport { ColDef } from '../../entities/colDef';\nimport { IFilterComp, IFilterDef } from '../../interfaces/iFilter';\nimport { UserComponentFactory } from '../../components/framework/userComponentFactory';\nimport { GridApi } from '../../gridApi';\nimport { ColumnApi } from '../../columnController/columnApi';\nimport { FilterManager } from './../filterManager';\nimport { ReadOnlyFloatingFilter } from './provided/readOnlyFloatingFilter';\nimport { ModuleNames } from '../../modules/moduleNames';\nimport { ModuleRegistry } from '../../modules/moduleRegistry';\nimport { addOrRemoveCssClass, setDisplayed } from '../../utils/dom';\nimport { createIconNoSpan } from '../../utils/icon';\nimport { AbstractHeaderWrapper } from '../../headerRendering/header/abstractHeaderWrapper';\nimport { Beans } from '../../rendering/beans';\nimport { HeaderRowComp } from '../../headerRendering/headerRowComp';\nimport { FloatingFilterMapper } from './floatingFilterMapper';\nimport { KeyCode } from '../../constants/keyCode';\n\nexport class FloatingFilterWrapper extends AbstractHeaderWrapper {\n    private static TEMPLATE = /* html */\n        `<div class=\"ag-header-cell\" role=\"gridcell\" tabindex=\"-1\">\n            <div class=\"ag-floating-filter-full-body\" ref=\"eFloatingFilterBody\" role=\"presentation\"></div>\n            <div class=\"ag-floating-filter-button ag-hidden\" ref=\"eButtonWrapper\" role=\"presentation\">\n                <button type=\"button\" aria-label=\"Open Filter Menu\" class=\"ag-floating-filter-button-button\" ref=\"eButtonShowMainFilter\" tabindex=\"-1\"></button>\n            </div>\n        </div>`;\n\n    @Autowired('columnHoverService') private readonly columnHoverService: ColumnHoverService;\n    @Autowired('userComponentFactory') private readonly userComponentFactory: UserComponentFactory;\n    @Autowired('gridApi') private readonly gridApi: GridApi;\n    @Autowired('columnApi') private readonly columnApi: ColumnApi;\n    @Autowired('filterManager') private readonly filterManager: FilterManager;\n    @Autowired('menuFactory') private readonly menuFactory: IMenuFactory;\n    @Autowired('beans') protected readonly beans: Beans;\n\n    @RefSelector('eFloatingFilterBody') private readonly eFloatingFilterBody: HTMLElement;\n    @RefSelector('eButtonWrapper') private readonly eButtonWrapper: HTMLElement;\n    @RefSelector('eButtonShowMainFilter') private readonly eButtonShowMainFilter: HTMLElement;\n\n    protected readonly column: Column;\n    protected readonly pinned: string | null;\n\n    private suppressFilterButton: boolean;\n\n    private floatingFilterCompPromise: AgPromise<IFloatingFilterComp> | null;\n\n    constructor(column: Column, pinned: string | null) {\n        super(FloatingFilterWrapper.TEMPLATE);\n        this.column = column;\n        this.pinned = pinned;\n    }\n\n    protected postConstruct(): void {\n        super.postConstruct();\n\n        this.setupFloatingFilter();\n        this.setupWidth();\n        this.setupLeftPositioning();\n        this.setupColumnHover();\n        this.createManagedBean(new HoverFeature([this.column], this.getGui()));\n\n        this.addManagedListener(this.eButtonShowMainFilter, 'click', this.showParentFilter.bind(this));\n    }\n\n    protected onTabKeyDown(e: KeyboardEvent) {\n        const activeEl = document.activeElement as HTMLElement;\n        const eGui = this.getGui();\n        const wrapperHasFocus = activeEl === eGui;\n\n        if (wrapperHasFocus) { return; }\n\n        e.preventDefault();\n\n        const nextFocusableEl = this.focusController.findNextFocusableElement(eGui, null, e.shiftKey);\n\n        if (nextFocusableEl) {\n            nextFocusableEl.focus();\n        } else {\n            eGui.focus();\n        }\n    }\n\n    protected handleKeyDown(e: KeyboardEvent) {\n        const activeEl = document.activeElement;\n        const eGui = this.getGui();\n        const wrapperHasFocus = activeEl === eGui;\n\n        switch (e.keyCode) {\n            case KeyCode.UP:\n            case KeyCode.DOWN:\n                if (!wrapperHasFocus) {\n                    e.preventDefault();\n                }\n            case KeyCode.LEFT:\n            case KeyCode.RIGHT:\n                if (wrapperHasFocus) { return; }\n                e.stopPropagation();\n            case KeyCode.ENTER:\n                if (wrapperHasFocus) {\n                    if (this.focusController.focusInto(eGui)) {\n                        e.preventDefault();\n                    }\n                }\n                break;\n            case KeyCode.ESCAPE:\n                if (!wrapperHasFocus) {\n                    this.getGui().focus();\n                }\n        }\n    }\n\n    protected onFocusIn(e: FocusEvent) {\n        const eGui = this.getGui();\n\n        if (!eGui.contains(e.relatedTarget as HTMLElement)) {\n            const headerRow = this.getParentComponent() as HeaderRowComp;\n            this.beans.focusController.setFocusedHeader(headerRow.getRowIndex(), this.getColumn());\n        }\n    }\n\n    private setupFloatingFilter(): void {\n        const colDef = this.column.getColDef();\n\n        if (!colDef.filter || !colDef.floatingFilter) { return; }\n\n        this.floatingFilterCompPromise = this.getFloatingFilterInstance();\n\n        if (!this.floatingFilterCompPromise) { return; }\n\n        this.floatingFilterCompPromise.then(compInstance => {\n            if (compInstance) {\n                this.setupWithFloatingFilter(compInstance);\n                this.setupSyncWithFilter();\n            }\n        });\n    }\n\n    private setupLeftPositioning(): void {\n        const setLeftFeature = new SetLeftFeature(this.column, this.getGui(), this.beans);\n        this.createManagedBean(setLeftFeature);\n    }\n\n    private setupSyncWithFilter(): void {\n        const syncWithFilter = (filterChangedEvent: FilterChangedEvent | null) => {\n            this.onParentModelChanged(this.currentParentModel(), filterChangedEvent);\n        };\n\n        this.addManagedListener(this.column, Column.EVENT_FILTER_CHANGED, syncWithFilter);\n\n        if (this.filterManager.isFilterActive(this.column)) {\n            syncWithFilter(null);\n        }\n    }\n\n    // linked to event listener in template\n    private showParentFilter() {\n        const eventSource = this.suppressFilterButton ? this.eFloatingFilterBody : this.eButtonShowMainFilter;\n\n        this.menuFactory.showMenuAfterButtonClick(this.column, eventSource, 'filterMenuTab', ['filterMenuTab']);\n    }\n\n    private setupColumnHover(): void {\n        this.addManagedListener(this.eventService, Events.EVENT_COLUMN_HOVER_CHANGED, this.onColumnHover.bind(this));\n        this.onColumnHover();\n    }\n\n    private onColumnHover(): void {\n        addOrRemoveCssClass(this.getGui(), 'ag-column-hover', this.columnHoverService.isHovered(this.column));\n    }\n\n    private setupWidth(): void {\n        this.addManagedListener(this.column, Column.EVENT_WIDTH_CHANGED, this.onColumnWidthChanged.bind(this));\n        this.onColumnWidthChanged();\n    }\n\n    private onColumnWidthChanged(): void {\n        this.getGui().style.width = `${this.column.getActualWidth()}px`;\n    }\n\n    private setupWithFloatingFilter(floatingFilterComp: IFloatingFilterComp): void {\n        const disposeFunc = () => {\n            this.getContext().destroyBean(floatingFilterComp);\n        };\n\n        if (!this.isAlive()) {\n            disposeFunc();\n            return;\n        }\n\n        this.addDestroyFunc(disposeFunc);\n\n        const floatingFilterCompUi = floatingFilterComp.getGui();\n\n        addOrRemoveCssClass(this.eFloatingFilterBody, 'ag-floating-filter-full-body', this.suppressFilterButton);\n        addOrRemoveCssClass(this.eFloatingFilterBody, 'ag-floating-filter-body', !this.suppressFilterButton);\n\n        setDisplayed(this.eButtonWrapper, !this.suppressFilterButton);\n\n        const eIcon = createIconNoSpan('filter', this.gridOptionsWrapper, this.column);\n        this.eButtonShowMainFilter.appendChild(eIcon!);\n\n        this.eFloatingFilterBody.appendChild(floatingFilterCompUi);\n\n        if (floatingFilterComp.afterGuiAttached) {\n            floatingFilterComp.afterGuiAttached();\n        }\n    }\n\n    private parentFilterInstance(callback: (filterInstance: IFilterComp) => void): void {\n        const filterComponent = this.getFilterComponent();\n\n        if (filterComponent) {\n            filterComponent.then(callback);\n        }\n    }\n\n    private getFilterComponent(createIfDoesNotExist = true): AgPromise<IFilterComp> | null {\n        return this.filterManager.getFilterComponent(this.column, 'NO_UI', createIfDoesNotExist);\n    }\n\n    public static getDefaultFloatingFilterType(def: IFilterDef): string | null {\n        if (def == null) { return null; }\n\n        let defaultFloatingFilterType: string | null = null;\n\n        if (typeof def.filter === 'string') {\n            // will be undefined if not in the map\n            defaultFloatingFilterType = FloatingFilterMapper.getFloatingFilterType(def.filter);\n        } else if (def.filterFramework) {\n            // If filterFramework, then grid is NOT using one of the provided filters, hence no default.\n            // Note: We could combine this with another part of the 'if' statement, however explicitly\n            // having this section makes the code easier to read.\n        } else if (def.filter === true) {\n            const setFilterModuleLoaded = ModuleRegistry.isRegistered(ModuleNames.SetFilterModule);\n            defaultFloatingFilterType = setFilterModuleLoaded ? 'agSetColumnFloatingFilter' : 'agTextColumnFloatingFilter';\n        }\n\n        return defaultFloatingFilterType;\n    }\n\n    private getFloatingFilterInstance(): AgPromise<IFloatingFilterComp> | null {\n        const colDef = this.column.getColDef();\n        const defaultFloatingFilterType = FloatingFilterWrapper.getDefaultFloatingFilterType(colDef);\n        const filterParams = this.filterManager.createFilterParams(this.column, colDef);\n        const finalFilterParams = this.userComponentFactory.createFinalParams(colDef, 'filter', filterParams);\n\n        const params: IFloatingFilterParams = {\n            api: this.gridApi,\n            column: this.column,\n            filterParams: finalFilterParams,\n            currentParentModel: this.currentParentModel.bind(this),\n            parentFilterInstance: this.parentFilterInstance.bind(this),\n            showParentFilter: this.showParentFilter.bind(this),\n            onFloatingFilterChanged: this.onFloatingFilterChanged.bind(this),\n            suppressFilterButton: false // This one might be overridden from the colDef\n        };\n\n        // this is unusual - we need a params value OUTSIDE the component the params are for.\n        // the params are for the floating filter component, but this property is actually for the wrapper.\n        this.suppressFilterButton = colDef.floatingFilterComponentParams ? !!colDef.floatingFilterComponentParams.suppressFilterButton : false;\n\n        let promise = this.userComponentFactory.newFloatingFilterComponent(colDef, params, defaultFloatingFilterType);\n\n        if (!promise) {\n            const compInstance =\n                this.userComponentFactory.createUserComponentFromConcreteClass(ReadOnlyFloatingFilter, params);\n\n            promise = AgPromise.resolve(compInstance);\n        }\n\n        return promise;\n    }\n\n    private currentParentModel(): any {\n        const filterComponent = this.getFilterComponent(false);\n\n        return filterComponent ? filterComponent.resolveNow(null, filter => filter && filter.getModel()) : null;\n    }\n\n    private onParentModelChanged(model: any, filterChangedEvent: FilterChangedEvent | null): void {\n        if (!this.floatingFilterCompPromise) { return; }\n\n        this.floatingFilterCompPromise.then(comp => comp && comp.onParentModelChanged(model, filterChangedEvent));\n    }\n\n    private onFloatingFilterChanged(): void {\n        console.warn('AG Grid: since version 21.x, how floating filters are implemented has changed. ' +\n            'Instead of calling params.onFloatingFilterChanged(), get a reference to the main filter via ' +\n            'params.parentFilterInstance() and then set a value on the parent filter directly.');\n    }\n}\n"]}