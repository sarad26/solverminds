{"version":3,"sources":["../../src/ts/widgets/popupService.ts"],"names":[],"mappings":"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","file":"popupService.js","sourcesContent":["import { Autowired, Bean } from \"../context/context\";\nimport { PostProcessPopupParams } from \"../entities/gridOptions\";\nimport { RowNode } from \"../entities/rowNode\";\nimport { Column } from \"../entities/column\";\nimport { Environment } from \"../environment\";\nimport { Events } from '../events';\nimport { BeanStub } from \"../context/beanStub\";\nimport {\n    addCssClass,\n    addOrRemoveCssClass,\n    containsClass,\n    getAbsoluteHeight,\n    getAbsoluteWidth,\n    removeCssClass\n} from '../utils/dom';\nimport { findIndex, forEach, last } from '../utils/array';\nimport { isElementInEventPath } from '../utils/event';\nimport { KeyCode } from '../constants/keyCode';\nimport { FocusController } from \"../focusController\";\nimport { GridCompController } from \"../gridComp/gridCompController\";\n\nexport interface PopupEventParams {\n    originalMouseEvent?: MouseEvent | Touch | null;\n    mouseEvent?: MouseEvent;\n    touchEvent?: TouchEvent;\n    keyboardEvent?: KeyboardEvent;\n}\n\ninterface AgPopup {\n    element: HTMLElement;\n    hideFunc: () => void;\n    stopAnchoringFunc?: () => void;\n}\n\ninterface Rect {\n    top: number;\n    left: number;\n    right: number;\n    bottom: number;\n}\n\nexport interface AfterGuiAttachedParams {\n    hidePopup: () => void;\n}\n\nexport interface AddPopupParams {\n    // if true then listens to background checking for clicks, so that when the background is clicked,\n    // the child is removed again, giving a model look to popups.\n    modal?: boolean;\n    // the element to place in the popup\n    eChild: any;\n    // if hitting ESC should close the popup\n    closeOnEsc?: boolean;\n    // a callback that gets called when the popup is closed\n    closedCallback?: (e?: MouseEvent | TouchEvent | KeyboardEvent) => void;\n    // if a clicked caused the popup (eg click a button) then the click that caused it\n    click?: MouseEvent | Touch | null;\n    alwaysOnTop?: boolean;\n    afterGuiAttached?: (params: AfterGuiAttachedParams) => void;\n    // this gets called after the popup is created. the called could just call positionCallback themselves,\n    // however it needs to be called first before anchorToElement is called, so must provide this callback\n    // here if setting anchorToElement\n    positionCallback?: () => void;\n    // if the underlying anchorToElement moves, the popup will follow it. for example if context menu\n    // showing, and the whole grid moves (browser is scrolled down) then we want the popup to stay above\n    // the cell it appeared on. make sure though if setting, don't anchor to a temporary or moving element,\n    // eg if cellComp element is passed, what happens if row moves (sorting, filtering etc)? best anchor against\n    // the grid, not the cell.\n    anchorToElement?: HTMLElement;\n}\n\nexport interface AddPopupResult {\n    hideFunc: () => void;\n    stopAnchoringFunc?: () => void;\n}\n\n@Bean('popupService')\nexport class PopupService extends BeanStub {\n\n    // really this should be using eGridDiv, not sure why it's not working.\n    // maybe popups in the future should be parent to the body??\n    @Autowired('environment') private environment: Environment;\n    @Autowired('focusController') private focusController: FocusController;\n\n    private gridCompController: GridCompController;\n    private popupList: AgPopup[] = [];\n\n    public registerGridCompController(gridCompController: GridCompController): void {\n        this.gridCompController = gridCompController;\n\n        this.addManagedListener(this.gridCompController, Events.EVENT_KEYBOARD_FOCUS, () => {\n            forEach(this.popupList, popup => addCssClass(popup.element, FocusController.AG_KEYBOARD_FOCUS));\n        });\n\n        this.addManagedListener(this.gridCompController, Events.EVENT_MOUSE_FOCUS, () => {\n            forEach(this.popupList, popup => removeCssClass(popup.element, FocusController.AG_KEYBOARD_FOCUS));\n        });\n    }\n\n    public getPopupParent(): HTMLElement {\n        const ePopupParent = this.gridOptionsWrapper.getPopupParent();\n\n        if (ePopupParent) { return ePopupParent; }\n\n        return this.gridCompController.getGui();\n    }\n\n    public positionPopupForMenu(params: { eventSource: HTMLElement, ePopup: HTMLElement; }): void {\n        const sourceRect = params.eventSource.getBoundingClientRect();\n        const parentRect = this.getParentRect();\n        const y = this.keepYWithinBounds(params, sourceRect.top - parentRect.top);\n\n        const minWidth = (params.ePopup.clientWidth > 0) ? params.ePopup.clientWidth : 200;\n        params.ePopup.style.minWidth = `${minWidth}px`;\n        const widthOfParent = parentRect.right - parentRect.left;\n        const maxX = widthOfParent - minWidth;\n\n        // the x position of the popup depends on RTL or LTR. for normal cases, LTR, we put the child popup\n        // to the right, unless it doesn't fit and we then put it to the left. for RTL it's the other way around,\n        // we try place it first to the left, and then if not to the right.\n        let x: number;\n        if (this.gridOptionsWrapper.isEnableRtl()) {\n            // for RTL, try left first\n            x = xLeftPosition();\n            if (x < 0) {\n                x = xRightPosition();\n            }\n            if (x > maxX) {\n                x = 0;\n            }\n        } else {\n            // for LTR, try right first\n            x = xRightPosition();\n            if (x > maxX) {\n                x = xLeftPosition();\n            }\n            if (x < 0) {\n                x = 0;\n            }\n        }\n\n        params.ePopup.style.left = `${x}px`;\n        params.ePopup.style.top = `${y}px`;\n\n        function xRightPosition(): number {\n            return sourceRect.right - parentRect.left - 2;\n        }\n\n        function xLeftPosition(): number {\n            return sourceRect.left - parentRect.left - minWidth;\n        }\n    }\n\n    public positionPopupUnderMouseEvent(params: {\n        rowNode?: RowNode,\n        column?: Column,\n        type: string,\n        mouseEvent: MouseEvent | Touch,\n        nudgeX?: number,\n        nudgeY?: number,\n        ePopup: HTMLElement,\n    }): void {\n\n        const { x, y } = this.calculatePointerAlign(params.mouseEvent);\n        const { ePopup, nudgeX, nudgeY } = params;\n\n        this.positionPopup({\n            ePopup: ePopup,\n            x,\n            y,\n            nudgeX,\n            nudgeY,\n            keepWithinBounds: true\n        });\n\n        this.callPostProcessPopup(params.type, params.ePopup, null, params.mouseEvent, params.column, params.rowNode);\n    }\n\n    private calculatePointerAlign(e: MouseEvent | Touch): { x: number, y: number; } {\n        const parentRect = this.getParentRect();\n\n        return {\n            x: e.clientX - parentRect.left,\n            y: e.clientY - parentRect.top\n        };\n    }\n\n    public positionPopupUnderComponent(params: {\n        type: string,\n        eventSource: HTMLElement,\n        ePopup: HTMLElement,\n        column?: Column,\n        rowNode?: RowNode,\n        minWidth?: number,\n        minHeight?: number,\n        nudgeX?: number,\n        nudgeY?: number,\n        alignSide?: 'left' | 'right',\n        keepWithinBounds?: boolean;\n    }) {\n        const sourceRect = params.eventSource.getBoundingClientRect();\n        const alignSide = params.alignSide || 'left';\n        const parentRect = this.getParentRect();\n\n        let x = sourceRect.left - parentRect.left;\n\n        if (alignSide === 'right') {\n            x -= (params.ePopup.offsetWidth - sourceRect.width);\n        }\n\n        this.positionPopup({\n            ePopup: params.ePopup,\n            minWidth: params.minWidth,\n            minHeight: params.minHeight,\n            nudgeX: params.nudgeX,\n            nudgeY: params.nudgeY,\n            x,\n            y: sourceRect.top - parentRect.top + sourceRect.height,\n            keepWithinBounds: params.keepWithinBounds\n        });\n\n        this.callPostProcessPopup(params.type, params.ePopup, params.eventSource, null, params.column, params.rowNode);\n    }\n\n    public positionPopupOverComponent(params: {\n        type: string,\n        eventSource: HTMLElement,\n        ePopup: HTMLElement,\n        column: Column,\n        rowNode: RowNode,\n        minWidth?: number,\n        nudgeX?: number,\n        nudgeY?: number,\n        keepWithinBounds?: boolean;\n    }) {\n        const sourceRect = params.eventSource.getBoundingClientRect();\n        const parentRect = this.getParentRect();\n\n        this.positionPopup({\n            ePopup: params.ePopup,\n            minWidth: params.minWidth,\n            nudgeX: params.nudgeX,\n            nudgeY: params.nudgeY,\n            x: sourceRect.left - parentRect.left,\n            y: sourceRect.top - parentRect.top,\n            keepWithinBounds: params.keepWithinBounds\n        });\n\n        this.callPostProcessPopup(params.type, params.ePopup, params.eventSource, null, params.column, params.rowNode);\n    }\n\n    private callPostProcessPopup(\n        type: string,\n        ePopup: HTMLElement,\n        eventSource?: HTMLElement | null,\n        mouseEvent?: MouseEvent | Touch | null,\n        column?: Column | null,\n        rowNode?: RowNode\n    ): void {\n        const callback = this.gridOptionsWrapper.getPostProcessPopupFunc();\n        if (callback) {\n            const params: PostProcessPopupParams = {\n                column: column,\n                rowNode: rowNode,\n                ePopup: ePopup,\n                type: type,\n                eventSource: eventSource,\n                mouseEvent: mouseEvent\n            };\n            callback(params);\n        }\n    }\n\n    public positionPopup(params: {\n        ePopup: HTMLElement,\n        minWidth?: number,\n        minHeight?: number,\n        nudgeX?: number,\n        nudgeY?: number,\n        x: number,\n        y: number,\n        keepWithinBounds?: boolean;\n    }): void {\n\n        let x = params.x;\n        let y = params.y;\n\n        if (params.nudgeX) {\n            x += params.nudgeX;\n        }\n        if (params.nudgeY) {\n            y += params.nudgeY;\n        }\n\n        // if popup is overflowing to the bottom, move it up\n        if (params.keepWithinBounds) {\n            x = this.keepXWithinBounds(params, x);\n            y = this.keepYWithinBounds(params, y);\n        }\n\n        params.ePopup.style.left = `${x}px`;\n        params.ePopup.style.top = `${y}px`;\n    }\n\n    public getActivePopups(): HTMLElement[] {\n        return this.popupList.map((popup) => popup.element);\n    }\n\n    private getParentRect(): Rect {\n        // subtract the popup parent borders, because popupParent.getBoundingClientRect\n        // returns the rect outside the borders, but the 0,0 coordinate for absolute\n        // positioning is inside the border, leading the popup to be off by the width\n        // of the border\n        let popupParent = this.getPopupParent();\n        const eDocument = this.gridOptionsWrapper.getDocument();\n        if (popupParent === eDocument.body) {\n            popupParent = eDocument.documentElement;\n        }\n        const style = getComputedStyle(popupParent);\n        const bounds = popupParent.getBoundingClientRect();\n        return {\n            top: bounds.top + parseFloat(style.borderTopWidth!) || 0,\n            left: bounds.left + parseFloat(style.borderLeftWidth!) || 0,\n            right: bounds.right + parseFloat(style.borderRightWidth!) || 0,\n            bottom: bounds.bottom + parseFloat(style.borderBottomWidth!) || 0,\n        };\n    }\n\n    private keepYWithinBounds(params: { ePopup: HTMLElement, minHeight?: number; }, y: number): number {\n        const eDocument = this.gridOptionsWrapper.getDocument();\n        const docElement = eDocument.documentElement;\n        const popupParent = this.getPopupParent();\n        const parentRect = popupParent.getBoundingClientRect();\n        const documentRect = eDocument.documentElement.getBoundingClientRect();\n        const isBody = popupParent === eDocument.body;\n\n        let minHeight = Math.min(200, parentRect.height);\n        let diff = 0;\n\n        if (params.minHeight && params.minHeight < minHeight) {\n            minHeight = params.minHeight;\n        } else if (params.ePopup.offsetHeight > 0) {\n            minHeight = params.ePopup.clientHeight;\n            diff = getAbsoluteHeight(params.ePopup) - minHeight;\n        }\n\n        let heightOfParent = isBody ? (getAbsoluteHeight(docElement) + docElement.scrollTop) : parentRect.height;\n\n        if (isBody) {\n            heightOfParent -= Math.abs(documentRect.top - parentRect.top);\n        }\n\n        const maxY = heightOfParent - minHeight - diff;\n\n        return Math.min(Math.max(y, 0), Math.abs(maxY));\n    }\n\n    private keepXWithinBounds(params: { minWidth?: number, ePopup: HTMLElement; }, x: number): number {\n        const eDocument = this.gridOptionsWrapper.getDocument();\n        const docElement = eDocument.documentElement;\n        const popupParent = this.getPopupParent();\n        const parentRect = popupParent.getBoundingClientRect();\n        const documentRect = eDocument.documentElement.getBoundingClientRect();\n        const isBody = popupParent === eDocument.body;\n        const ePopup = params.ePopup;\n\n        let minWidth = Math.min(200, parentRect.width);\n        let diff = 0;\n\n        if (params.minWidth && params.minWidth < minWidth) {\n            minWidth = params.minWidth;\n        } else if (ePopup.offsetWidth > 0) {\n            minWidth = ePopup.offsetWidth;\n            ePopup.style.minWidth = `${minWidth}px`;\n            diff = getAbsoluteWidth(ePopup) - minWidth;\n        }\n\n        let widthOfParent = isBody ? (getAbsoluteWidth(docElement) + docElement.scrollLeft) : parentRect.width;\n\n        if (isBody) {\n            widthOfParent -= Math.abs(documentRect.left - parentRect.left);\n        }\n\n        const maxX = widthOfParent - minWidth - diff;\n\n        return Math.min(Math.max(x, 0), Math.abs(maxX));\n    }\n\n    private keepPopupPositionedRelativeTo(params: {\n        ePopup: HTMLElement,\n        element: HTMLElement,\n        hidePopup: () => void;\n    }): () => void {\n        const eParent = this.getPopupParent();\n        const parentRect = eParent.getBoundingClientRect();\n\n        const sourceRect = params.element.getBoundingClientRect();\n        const initialDiffTop = parentRect.top - sourceRect.top;\n        const initialDiffLeft = parentRect.left - sourceRect.left;\n\n        let lastDiffTop = initialDiffTop;\n        let lastDiffLeft = initialDiffLeft;\n\n        const topPx = params.ePopup.style.top;\n        const top = parseInt(topPx!.substring(0, topPx!.length - 1), 10);\n\n        const leftPx = params.ePopup.style.left;\n        const left = parseInt(leftPx!.substring(0, leftPx!.length - 1), 10);\n\n        let intervalId: number | undefined = window.setInterval(() => {\n            const pRect = eParent.getBoundingClientRect();\n            const sRect = params.element.getBoundingClientRect();\n\n            const elementNotInDom = sRect.top == 0 && sRect.left == 0 && sRect.height == 0 && sRect.width == 0;\n            if (elementNotInDom) {\n                params.hidePopup();\n                return;\n            }\n\n            const currentDiffTop = pRect.top - sRect.top;\n            if (currentDiffTop != lastDiffTop) {\n                const newTop = top + initialDiffTop - currentDiffTop;\n                params.ePopup.style.top = `${newTop}px`;\n            }\n            lastDiffTop = currentDiffTop;\n\n            const currentDiffLeft = pRect.left - sRect.left;\n            if (currentDiffLeft != lastDiffLeft) {\n                const newLeft = left + initialDiffLeft - currentDiffLeft;\n                params.ePopup.style.left = `${newLeft}px`;\n            }\n            lastDiffLeft = currentDiffLeft;\n\n        }, 200);\n\n        const res = () => {\n            if (intervalId != null) {\n                window.clearInterval(intervalId);\n            }\n            intervalId = undefined;\n        };\n\n        return res;\n    }\n\n    public addPopup(params: AddPopupParams): AddPopupResult | undefined {\n        const {\n            modal,\n            eChild,\n            closeOnEsc,\n            closedCallback,\n            click,\n            alwaysOnTop,\n            afterGuiAttached,\n            positionCallback,\n            anchorToElement\n        } = params;\n\n        const eDocument = this.gridOptionsWrapper.getDocument();\n\n        if (!eDocument) {\n            console.warn('ag-grid: could not find the document, document is empty');\n            return;\n        }\n\n        const pos = findIndex(this.popupList, popup => popup.element === eChild);\n\n        if (pos !== -1) {\n            const popup = this.popupList[pos];\n            return { hideFunc: popup.hideFunc, stopAnchoringFunc: popup.stopAnchoringFunc };\n        }\n\n        const ePopupParent = this.getPopupParent();\n\n        // for angular specifically, but shouldn't cause an issue with js or other fw's\n        // https://github.com/angular/angular/issues/8563\n        ePopupParent.appendChild(eChild);\n\n        if (eChild.style.top == null) {\n            eChild.style.top = '0px';\n        }\n        if (eChild.style.left == null) {\n            eChild.style.left = '0px';\n        }\n\n        // add env CSS class to child, in case user provided a popup parent, which means\n        // theme class may be missing\n        const eWrapper = document.createElement('div');\n        const { theme } = this.environment.getTheme();\n\n        if (theme) {\n            addCssClass(eWrapper, theme);\n        }\n\n        addCssClass(eWrapper, 'ag-popup');\n        addCssClass(eChild, this.gridOptionsWrapper.isEnableRtl() ? 'ag-rtl' : 'ag-ltr');\n        addCssClass(eChild, 'ag-popup-child');\n\n        if (this.focusController.isKeyboardMode()) {\n            addCssClass(eChild, FocusController.AG_KEYBOARD_FOCUS)\n        }\n\n        eWrapper.appendChild(eChild);\n        ePopupParent.appendChild(eWrapper);\n\n        if (alwaysOnTop) {\n            this.setAlwaysOnTop(eWrapper, true);\n        } else {\n            this.bringPopupToFront(eWrapper);\n        }\n\n        let popupHidden = false;\n\n        const hidePopupOnKeyboardEvent = (event: KeyboardEvent) => {\n            if (!eWrapper.contains(document.activeElement)) { return; }\n\n            const key = event.which || event.keyCode;\n\n            if (key === KeyCode.ESCAPE) {\n                hidePopup({ keyboardEvent: event });\n            }\n        };\n\n        const hidePopupOnMouseEvent = (event: MouseEvent) => hidePopup({ mouseEvent: event });\n        const hidePopupOnTouchEvent = (event: TouchEvent) => hidePopup({ touchEvent: event });\n\n        let destroyPositionTracker: (() => void) | undefined;\n\n        const hidePopup = (popupParams: PopupEventParams = {}) => {\n            const { mouseEvent, touchEvent, keyboardEvent } = popupParams;\n            if (\n                // we don't hide popup if the event was on the child, or any\n                // children of this child\n                this.isEventFromCurrentPopup({ mouseEvent, touchEvent }, eChild) ||\n                // if the event to close is actually the open event, then ignore it\n                this.isEventSameChainAsOriginalEvent({ originalMouseEvent: click, mouseEvent, touchEvent }) ||\n                // this method should only be called once. the client can have different\n                // paths, each one wanting to close, so this method may be called multiple times.\n                popupHidden\n            ) {\n                return;\n            }\n\n            popupHidden = true;\n\n            ePopupParent.removeChild(eWrapper);\n\n            eDocument.removeEventListener('keydown', hidePopupOnKeyboardEvent);\n            eDocument.removeEventListener('mousedown', hidePopupOnMouseEvent);\n            eDocument.removeEventListener('touchstart', hidePopupOnTouchEvent);\n            eDocument.removeEventListener('contextmenu', hidePopupOnMouseEvent);\n\n            this.eventService.removeEventListener(Events.EVENT_DRAG_STARTED, hidePopupOnMouseEvent);\n\n            if (closedCallback) {\n                closedCallback(mouseEvent || touchEvent || keyboardEvent);\n            }\n\n            this.popupList = this.popupList.filter(popup => popup.element !== eChild);\n\n            if (destroyPositionTracker) {\n                destroyPositionTracker();\n            }\n        };\n\n        if (afterGuiAttached) {\n            afterGuiAttached({ hidePopup });\n        }\n\n        // if we add these listeners now, then the current mouse\n        // click will be included, which we don't want\n        window.setTimeout(() => {\n            if (closeOnEsc) {\n                eDocument.addEventListener('keydown', hidePopupOnKeyboardEvent);\n            }\n\n            if (modal) {\n                eDocument.addEventListener('mousedown', hidePopupOnMouseEvent);\n                this.eventService.addEventListener(Events.EVENT_DRAG_STARTED, hidePopupOnMouseEvent);\n                eDocument.addEventListener('touchstart', hidePopupOnTouchEvent);\n                eDocument.addEventListener('contextmenu', hidePopupOnMouseEvent);\n            }\n        }, 0);\n\n        if (positionCallback) {\n            positionCallback();\n        }\n\n        if (anchorToElement) {\n            // keeps popup positioned under created, eg if context menu, if user scrolls\n            // using touchpad and the cell moves, it moves the popup to keep it with the cell.\n            destroyPositionTracker = this.keepPopupPositionedRelativeTo({\n                element: anchorToElement,\n                ePopup: eChild,\n                hidePopup\n            });\n        }\n\n        this.popupList.push({\n            element: eChild,\n            hideFunc: hidePopup,\n            stopAnchoringFunc: destroyPositionTracker\n        });\n\n        return {\n            hideFunc: hidePopup,\n            stopAnchoringFunc: destroyPositionTracker\n        };\n    }\n\n    private isEventFromCurrentPopup(params: PopupEventParams, target: HTMLElement): boolean {\n        const { mouseEvent, touchEvent } = params;\n\n        const event = mouseEvent ? mouseEvent : touchEvent;\n\n        if (!event) {\n            return false;\n        }\n\n        const indexOfThisChild = findIndex(this.popupList, popup => popup.element === target);\n\n        if (indexOfThisChild === -1) {\n            return false;\n        }\n\n        for (let i = indexOfThisChild; i < this.popupList.length; i++) {\n            const popup = this.popupList[i];\n\n            if (isElementInEventPath(popup.element, event)) {\n                return true;\n            }\n        }\n\n        // if the user did not write their own Custom Element to be rendered as popup\n        // and this component has an additional popup element, they should have the\n        // `ag-custom-component-popup` class to be detected as part of the Custom Component\n        return this.isElementWithinCustomPopup(event.target as HTMLElement);\n    }\n\n    public isElementWithinCustomPopup(el: HTMLElement): boolean {\n        if (!this.popupList.length) { return false; }\n\n        while (el && el !== document.body) {\n            if (el.classList.contains('ag-custom-component-popup') || el.parentElement === null) { return true; }\n            el = el.parentElement;\n        }\n\n        return false;\n    }\n\n    // in some browsers, the context menu event can be fired before the click event, which means\n    // the context menu event could open the popup, but then the click event closes it straight away.\n    private isEventSameChainAsOriginalEvent(params: PopupEventParams): boolean {\n        const { originalMouseEvent, mouseEvent, touchEvent } = params;\n        // we check the coordinates of the event, to see if it's the same event. there is a 1 / 1000 chance that\n        // the event is a different event, however that is an edge case that is not very relevant (the user clicking\n        // twice on the same location isn't a normal path).\n\n        // event could be mouse event or touch event.\n        let mouseEventOrTouch: MouseEvent | Touch | null = null;\n\n        if (mouseEvent) {\n            // mouse event can be used direction, it has coordinates\n            mouseEventOrTouch = mouseEvent;\n        } else if (touchEvent) {\n            // touch event doesn't have coordinates, need it's touch object\n            mouseEventOrTouch = touchEvent.touches[0];\n        }\n        if (mouseEventOrTouch && originalMouseEvent) {\n            // for x, allow 4px margin, to cover iPads, where touch (which opens menu) is followed\n            // by browser click (when you finger up, touch is interrupted as click in browser)\n            const screenX = mouseEvent ? mouseEvent.screenX : 0;\n            const screenY = mouseEvent ? mouseEvent.screenY : 0;\n\n            const xMatch = Math.abs(originalMouseEvent.screenX - screenX) < 5;\n            const yMatch = Math.abs(originalMouseEvent.screenY - screenY) < 5;\n\n            if (xMatch && yMatch) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    private getWrapper(ePopup: HTMLElement): HTMLElement | null {\n        while (!containsClass(ePopup, 'ag-popup') && ePopup.parentElement) {\n            ePopup = ePopup.parentElement;\n        }\n\n        return containsClass(ePopup, 'ag-popup') ? ePopup : null;\n    }\n\n    public setAlwaysOnTop(ePopup: HTMLElement, alwaysOnTop?: boolean): void {\n        const eWrapper = this.getWrapper(ePopup);\n\n        if (!eWrapper) { return; }\n\n        addOrRemoveCssClass(eWrapper, 'ag-always-on-top', !!alwaysOnTop);\n\n        if (alwaysOnTop) {\n            this.bringPopupToFront(eWrapper);\n        }\n    }\n\n    public bringPopupToFront(ePopup: HTMLElement) {\n        const parent = this.getPopupParent();\n        const popupList: HTMLElement[] = Array.prototype.slice.call(parent.querySelectorAll('.ag-popup'));\n        const popupLen = popupList.length;\n        const alwaysOnTopList: HTMLElement[] = Array.prototype.slice.call(parent.querySelectorAll('.ag-popup.ag-always-on-top'));\n        const onTopLength = alwaysOnTopList.length;\n        const eWrapper = this.getWrapper(ePopup);\n\n        if (!eWrapper || popupLen <= 1 || !parent.contains(ePopup)) { return; }\n\n        const pos = popupList.indexOf(eWrapper);\n\n        if (onTopLength) {\n            const isPopupAlwaysOnTop = containsClass(eWrapper, 'ag-always-on-top');\n\n            if (isPopupAlwaysOnTop) {\n                if (pos !== popupLen - 1) {\n                    last(alwaysOnTopList).insertAdjacentElement('afterend', eWrapper);\n                }\n            } else if (pos !== popupLen - onTopLength - 1) {\n                alwaysOnTopList[0].insertAdjacentElement('beforebegin', eWrapper);\n            }\n        } else if (pos !== popupLen - 1) {\n            last(popupList).insertAdjacentElement('afterend', eWrapper);\n        }\n\n        const params = {\n            type: 'popupToFront',\n            api: this.gridOptionsWrapper.getApi(),\n            columnApi: this.gridOptionsWrapper.getColumnApi(),\n            eWrapper\n        };\n\n        this.eventService.dispatchEvent(params);\n    }\n}\n"]}