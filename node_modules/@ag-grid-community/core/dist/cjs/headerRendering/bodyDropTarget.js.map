{"version":3,"sources":["../../src/ts/headerRendering/bodyDropTarget.ts"],"names":[],"mappings":"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","file":"bodyDropTarget.js","sourcesContent":["import { DragAndDropService, DraggingEvent, DragSourceType, DropTarget } from \"../dragAndDrop/dragAndDropService\";\nimport { Autowired, PostConstruct } from \"../context/context\";\nimport { MoveColumnController } from \"./moveColumnController\";\nimport { BodyDropPivotTarget } from \"./bodyDropPivotTarget\";\nimport { ColumnController } from \"../columnController/columnController\";\nimport { Constants } from \"../constants/constants\";\nimport { BeanStub } from \"../context/beanStub\";\nimport { ControllersService } from \"../controllersService\";\nimport { RowContainerController } from \"../gridBodyComp/rowContainer/rowContainerController\";\n\nexport interface DropListener {\n    getIconName(): string | null;\n    onDragEnter(params: DraggingEvent): void;\n    onDragLeave(params: DraggingEvent): void;\n    onDragging(params: DraggingEvent): void;\n    onDragStop(params: DraggingEvent): void;\n}\n\nenum DropType { ColumnMove, Pivot }\n\nexport class BodyDropTarget extends BeanStub implements DropTarget {\n\n    @Autowired('dragAndDropService') private dragAndDropService: DragAndDropService;\n    @Autowired('columnController') private columnController: ColumnController;\n    @Autowired('controllersService') private controllersService: ControllersService;\n\n    private pinned: string | null;\n    // public because it's part of the DropTarget interface\n    private eContainer: HTMLElement;\n    // public because it's part of the DropTarget interface\n    private eSecondaryContainers: HTMLElement[];\n    private dropListeners: { [type: number]: DropListener; } = {};\n    private currentDropListener: DropListener;\n    private moveColumnController: MoveColumnController;\n\n    constructor(pinned: string | null, eContainer: HTMLElement) {\n        super();\n        this.pinned = pinned;\n        this.eContainer = eContainer;\n    }\n\n    @PostConstruct\n    private postConstruct(): void {\n        this.controllersService.whenReady(p => {\n            let containers: RowContainerController[];\n            switch (this.pinned) {\n                case Constants.PINNED_LEFT:\n                    containers = [p.leftRowContainerCon, p.bottomLeftRowContainerCon, p.topLeftRowContainerCon];\n                    break;\n                case Constants.PINNED_RIGHT:\n                    containers = [p.rightRowContainerCon, p.bottomRightRowContainerCon, p.topRightRowContainerCon];\n                    break;\n                default:\n                    containers = [p.centerRowContainerCon, p.bottomCenterRowContainerCon, p.topCenterRowContainerCon];\n                    break;\n            }\n            this.eSecondaryContainers = containers.map(c => c.getContainerElement());\n        });\n    }\n\n    public isInterestedIn(type: DragSourceType): boolean {\n        return type === DragSourceType.HeaderCell ||\n            (type === DragSourceType.ToolPanel && this.gridOptionsWrapper.isAllowDragFromColumnsToolPanel());\n    }\n\n    public getSecondaryContainers(): HTMLElement[] {\n        return this.eSecondaryContainers;\n    }\n\n    public getContainer(): HTMLElement {\n        return this.eContainer;\n    }\n\n    @PostConstruct\n    private init(): void {\n\n        this.moveColumnController = this.createBean(new MoveColumnController(this.pinned, this.eContainer));\n\n        const bodyDropPivotTarget = new BodyDropPivotTarget(this.pinned);\n        this.createBean(bodyDropPivotTarget);\n\n        this.dropListeners[DropType.ColumnMove] = this.moveColumnController;\n        this.dropListeners[DropType.Pivot] = bodyDropPivotTarget;\n\n        this.dragAndDropService.addDropTarget(this);\n    }\n\n    public getIconName(): string | null {\n        return this.currentDropListener.getIconName();\n    }\n\n    // we want to use the bodyPivotTarget if the user is dragging columns in from the toolPanel\n    // and we are in pivot mode, as it has to logic to set pivot/value/group on the columns when\n    // dropped into the grid's body.\n    private getDropType(draggingEvent: DraggingEvent): DropType {\n        if (this.columnController.isPivotMode()) {\n            // in pivot mode, then if moving a column (ie didn't come from toolpanel) then it's\n            // a standard column move, however if it came from the toolpanel, then we are introducing\n            // dimensions or values to the grid\n            if (draggingEvent.dragSource.type === DragSourceType.ToolPanel) {\n                return DropType.Pivot;\n            }\n\n            return DropType.ColumnMove;\n        }\n\n        // it's a column, and not pivot mode, so always moving\n        return DropType.ColumnMove;\n    }\n\n    public onDragEnter(draggingEvent: DraggingEvent): void {\n        // we pick the drop listener depending on whether we are in pivot mode are not. if we are\n        // in pivot mode, then dropping cols changes the row group, pivot, value stats. otherwise\n        // we change visibility state and position.\n\n        // if (this.columnController.isPivotMode()) {\n        const dropType: DropType = this.getDropType(draggingEvent);\n\n        this.currentDropListener = this.dropListeners[dropType];\n        this.currentDropListener.onDragEnter(draggingEvent);\n    }\n\n    public onDragLeave(params: DraggingEvent): void {\n        this.currentDropListener.onDragLeave(params);\n    }\n\n    public onDragging(params: DraggingEvent): void {\n        this.currentDropListener.onDragging(params);\n    }\n\n    public onDragStop(params: DraggingEvent): void {\n        this.currentDropListener.onDragStop(params);\n    }\n\n}\n"]}