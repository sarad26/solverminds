{"version":3,"sources":["../../src/ts/focusController.ts"],"names":[],"mappings":"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","file":"focusController.js","sourcesContent":["import { Autowired, Bean, Optional, PostConstruct } from \"./context/context\";\nimport { BeanStub } from \"./context/beanStub\";\nimport { Column } from \"./entities/column\";\nimport { CellFocusedEvent, Events } from \"./events\";\nimport { ColumnApi } from \"./columnController/columnApi\";\nimport { ColumnController } from \"./columnController/columnController\";\nimport { CellPosition } from \"./entities/cellPosition\";\nimport { RowNode } from \"./entities/rowNode\";\nimport { GridApi } from \"./gridApi\";\nimport { CellComp } from \"./rendering/cellComp\";\nimport { HeaderRowComp } from \"./headerRendering/headerRowComp\";\nimport { AbstractHeaderWrapper } from \"./headerRendering/header/abstractHeaderWrapper\";\nimport { HeaderPosition } from \"./headerRendering/header/headerPosition\";\nimport { RowPositionUtils } from \"./entities/rowPosition\";\nimport { IRangeController } from \"./interfaces/iRangeController\";\nimport { RowRenderer } from \"./rendering/rowRenderer\";\nimport { HeaderNavigationService } from \"./headerRendering/header/headerNavigationService\";\nimport { ColumnGroup } from \"./entities/columnGroup\";\nimport { ManagedFocusComponent } from \"./widgets/managedFocusComponent\";\nimport { getTabIndex } from './utils/browser';\nimport { findIndex, last } from './utils/array';\nimport { makeNull } from './utils/generic';\nimport { Constants } from \"./constants/constants\";\nimport { GridCompController } from \"./gridComp/gridCompController\";\n\n@Bean('focusController')\nexport class FocusController extends BeanStub {\n\n    @Autowired('columnController') private readonly columnController: ColumnController;\n    @Autowired('headerNavigationService') private readonly headerNavigationService: HeaderNavigationService;\n    @Autowired('columnApi') private readonly columnApi: ColumnApi;\n    @Autowired('gridApi') private readonly gridApi: GridApi;\n    @Autowired('rowRenderer') private readonly rowRenderer: RowRenderer;\n    @Autowired('rowPositionUtils') private readonly rowPositionUtils: RowPositionUtils;\n    @Optional('rangeController') private readonly rangeController: IRangeController;\n\n    public static AG_KEYBOARD_FOCUS: string = 'ag-keyboard-focus';\n\n    private gridCompController: GridCompController;\n    private focusedCellPosition: CellPosition | null;\n    private focusedHeaderPosition: HeaderPosition | null;\n\n    private static keyboardModeActive: boolean = false;\n    private static instancesMonitored: Map<Document, GridCompController[]> = new Map();\n\n    /**\n     * Adds a gridCore to the list of the gridCores monitoring Keyboard Mode\n     * in a specific HTMLDocument.\n     *\n     * @param doc {Document} - The Document containing the gridCore.\n     * @param gridCore {GridComp} - The GridCore to be monitored.\n     */\n    private static addKeyboardModeEvents(doc: Document, controller: GridCompController): void {\n        const docControllers = FocusController.instancesMonitored.get(doc);\n\n        if (docControllers && docControllers.length > 0) {\n            if (docControllers.indexOf(controller) === -1) {\n                docControllers.push(controller);\n            }\n        } else {\n            FocusController.instancesMonitored.set(doc, [controller]);\n            doc.addEventListener('keydown', FocusController.toggleKeyboardMode);\n            doc.addEventListener('mousedown', FocusController.toggleKeyboardMode);\n        }\n    }\n\n    /**\n     * Removes a gridCore from the list of the gridCores monitoring Keyboard Mode\n     * in a specific HTMLDocument.\n     *\n     * @param doc {Document} - The Document containing the gridCore.\n     * @param gridCore {GridComp} - The GridCore to be removed.\n     */\n    private static removeKeyboardModeEvents(doc: Document, controller: GridCompController): void {\n        const docControllers = FocusController.instancesMonitored.get(doc);\n\n        let newControllers: GridCompController[] = [];\n\n        if (docControllers && docControllers.length) {\n            newControllers = [...docControllers].filter(\n                currentGridCore => currentGridCore !== controller\n            );\n            FocusController.instancesMonitored.set(doc, newControllers);\n        }\n\n        if (newControllers.length === 0) {\n            doc.removeEventListener('keydown', FocusController.toggleKeyboardMode);\n            doc.removeEventListener('mousedown', FocusController.toggleKeyboardMode);\n        }\n    }\n\n    /**\n     * This method will be called by `keydown` and `mousedown` events on all Documents monitoring\n     * KeyboardMode. It will then fire a KEYBOARD_FOCUS, MOUSE_FOCUS on each gridCore present in\n     * the Document allowing each gridCore to maintain a state for KeyboardMode.\n     *\n     * @param event {KeyboardEvent | MouseEvent | TouchEvent} - The event triggered.\n     */\n    private static toggleKeyboardMode(event: KeyboardEvent | MouseEvent | TouchEvent): void {\n        const isKeyboardActive = FocusController.keyboardModeActive;\n        const isKeyboardEvent = event.type === 'keydown';\n\n        if (isKeyboardEvent) {\n            // the following keys should not toggle keyboard mode.\n            if (event.ctrlKey || event.metaKey || event.altKey) { return; }\n        }\n\n        if (isKeyboardActive && isKeyboardEvent || !isKeyboardActive && !isKeyboardEvent) { return; }\n\n        FocusController.keyboardModeActive = isKeyboardEvent;\n        const doc = (event.target as HTMLElement).ownerDocument;\n\n        if (!doc) { return; }\n\n        const controllersForDoc = FocusController.instancesMonitored.get(doc);\n\n        if (controllersForDoc) {\n            controllersForDoc.forEach(controller => {\n                controller.dispatchEvent({ type: isKeyboardEvent ? Events.EVENT_KEYBOARD_FOCUS : Events.EVENT_MOUSE_FOCUS });\n            });\n        }\n    }\n\n    @PostConstruct\n    private init(): void {\n        const clearFocusedCellListener = this.clearFocusedCell.bind(this);\n\n        this.addManagedListener(this.eventService, Events.EVENT_COLUMN_PIVOT_MODE_CHANGED, clearFocusedCellListener);\n        this.addManagedListener(this.eventService, Events.EVENT_NEW_COLUMNS_LOADED, this.onColumnEverythingChanged.bind(this));\n        this.addManagedListener(this.eventService, Events.EVENT_COLUMN_GROUP_OPENED, clearFocusedCellListener);\n        this.addManagedListener(this.eventService, Events.EVENT_COLUMN_ROW_GROUP_CHANGED, clearFocusedCellListener);\n    }\n\n    public registerGridCompController(gridCompController: GridCompController): void {\n        this.gridCompController = gridCompController;\n\n        const doc = this.gridOptionsWrapper.getDocument();\n        FocusController.addKeyboardModeEvents(doc, gridCompController);\n        this.addDestroyFunc(() => this.unregisterGridCompController(gridCompController));\n    }\n\n    public unregisterGridCompController(gridCompController: GridCompController): void {\n        const doc = this.gridOptionsWrapper.getDocument();\n\n        FocusController.removeKeyboardModeEvents(doc, gridCompController);\n    }\n\n    public onColumnEverythingChanged(): void {\n        // if the columns change, check and see if this column still exists. if it does, then\n        // we can keep the focused cell. if it doesn't, then we need to drop the focused cell.\n        if (!this.focusedCellPosition) { return; }\n\n        const col = this.focusedCellPosition.column;\n        const colFromColumnController = this.columnController.getGridColumn(col.getId());\n\n        if (col !== colFromColumnController) {\n            this.clearFocusedCell();\n        }\n    }\n\n    public isKeyboardMode(): boolean {\n        return FocusController.keyboardModeActive;\n    }\n\n    // we check if the browser is focusing something, and if it is, and\n    // it's the cell we think is focused, then return the cell. so this\n    // methods returns the cell if a) we think it has focus and b) the\n    // browser thinks it has focus. this then returns nothing if we\n    // first focus a cell, then second click outside the grid, as then the\n    // grid cell will still be focused as far as the grid is concerned,\n    // however the browser focus will have moved somewhere else.\n    public getFocusCellToUseAfterRefresh(): CellPosition | null {\n        if (this.gridOptionsWrapper.isSuppressFocusAfterRefresh() || !this.focusedCellPosition) {\n            return null;\n        }\n\n        // we check that the browser is actually focusing on the grid, if it is not, then\n        // we have nothing to worry about\n        if (!this.getGridCellForDomElement(document.activeElement)) {\n            return null;\n        }\n\n        return this.focusedCellPosition;\n    }\n\n    private getGridCellForDomElement(eBrowserCell: Node | null): CellPosition | null {\n        let ePointer = eBrowserCell;\n\n        while (ePointer) {\n            const cellComp = this.gridOptionsWrapper.getDomData(ePointer, CellComp.DOM_DATA_KEY_CELL_COMP) as CellComp;\n\n            if (cellComp) {\n                return cellComp.getCellPosition();\n            }\n\n            ePointer = ePointer.parentNode;\n        }\n\n        return null;\n    }\n\n    public clearFocusedCell(): void {\n        this.focusedCellPosition = null;\n        this.onCellFocused(false);\n    }\n\n    public getFocusedCell(): CellPosition | null {\n        return this.focusedCellPosition;\n    }\n\n    public setFocusedCell(rowIndex: number, colKey: string | Column, floating: string | null | undefined, forceBrowserFocus = false): void {\n        const gridColumn = this.columnController.getGridColumn(colKey);\n\n        // if column doesn't exist, then blank the focused cell and return. this can happen when user sets new columns,\n        // and the focused cell is in a column that no longer exists. after columns change, the grid refreshes and tries\n        // to re-focus the focused cell.\n        if (!gridColumn) {\n            this.focusedCellPosition = null;\n            return;\n        }\n\n        this.focusedCellPosition = gridColumn ? { rowIndex, rowPinned: makeNull(floating), column: gridColumn } : null;\n        this.onCellFocused(forceBrowserFocus);\n    }\n\n    public isCellFocused(cellPosition: CellPosition): boolean {\n        if (this.focusedCellPosition == null) { return false; }\n\n        return this.focusedCellPosition.column === cellPosition.column &&\n            this.isRowFocused(cellPosition.rowIndex, cellPosition.rowPinned);\n    }\n\n    public isRowNodeFocused(rowNode: RowNode): boolean {\n        return this.isRowFocused(rowNode.rowIndex!, rowNode.rowPinned);\n    }\n\n    public isHeaderWrapperFocused(headerWrapper: AbstractHeaderWrapper): boolean {\n        if (this.focusedHeaderPosition == null) { return false; }\n\n        const column = headerWrapper.getColumn();\n        const headerRowIndex = (headerWrapper.getParentComponent() as HeaderRowComp).getRowIndex();\n        const pinned = headerWrapper.getPinned();\n\n        const { column: focusedColumn, headerRowIndex: focusedHeaderRowIndex } = this.focusedHeaderPosition;\n\n        return column === focusedColumn &&\n            headerRowIndex === focusedHeaderRowIndex &&\n            pinned == focusedColumn.getPinned();\n    }\n\n    public clearFocusedHeader(): void {\n        this.focusedHeaderPosition = null;\n    }\n\n    public getFocusedHeader(): HeaderPosition | null {\n        return this.focusedHeaderPosition;\n    }\n\n    public setFocusedHeader(headerRowIndex: number, column: ColumnGroup | Column): void {\n        this.focusedHeaderPosition = { headerRowIndex, column };\n    }\n\n    public focusHeaderPosition(\n        headerPosition: HeaderPosition | null,\n        direction: 'Before' | 'After' | undefined | null = null,\n        fromTab: boolean = false,\n        allowUserOverride: boolean = false,\n        event?: KeyboardEvent\n    ): boolean {\n        if (allowUserOverride) {\n            const { gridOptionsWrapper } = this;\n            const currentPosition = this.getFocusedHeader();\n            const headerRowCount = this.headerNavigationService.getHeaderRowCount();\n\n            if (fromTab) {\n                const userFunc = gridOptionsWrapper.getTabToNextHeaderFunc();\n                if (userFunc) {\n                    const params = {\n                        backwards: direction === 'Before',\n                        previousHeaderPosition: currentPosition,\n                        nextHeaderPosition: headerPosition,\n                        headerRowCount\n                    };\n                    headerPosition = userFunc(params);\n                }\n            } else {\n                const userFunc = gridOptionsWrapper.getNavigateToNextHeaderFunc();\n                if (userFunc && event) {\n                    const params = {\n                        key: event.key,\n                        previousHeaderPosition: currentPosition,\n                        nextHeaderPosition: headerPosition,\n                        headerRowCount,\n                        event\n                    };\n                    headerPosition = userFunc(params);\n                }\n            }\n        }\n\n        if (!headerPosition) { return false; }\n\n        if (headerPosition.headerRowIndex === -1) {\n            return this.focusGridView(headerPosition.column as Column);\n        }\n\n        this.headerNavigationService.scrollToColumn(headerPosition.column, direction);\n\n        const childContainer = this.headerNavigationService.getHeaderContainer(headerPosition.column.getPinned());\n        const rowComps = childContainer!.getRowComps();\n        const nextRowComp = rowComps[headerPosition.headerRowIndex];\n        const headerComps = nextRowComp.getHeaderComps();\n        const nextHeader = headerComps[headerPosition.column.getUniqueId()];\n\n        if (nextHeader) {\n            // this will automatically call the setFocusedHeader method above\n            nextHeader.getFocusableElement().focus();\n            return true;\n        }\n\n        return false;\n    }\n\n    public isAnyCellFocused(): boolean {\n        return !!this.focusedCellPosition;\n    }\n\n    public isRowFocused(rowIndex: number, floating?: string | null): boolean {\n        if (this.focusedCellPosition == null) { return false; }\n\n        return this.focusedCellPosition.rowIndex === rowIndex && this.focusedCellPosition.rowPinned === makeNull(floating);\n    }\n\n    public findFocusableElements(rootNode: HTMLElement, exclude?: string | null, onlyUnmanaged = false): HTMLElement[] {\n        const focusableString = Constants.FOCUSABLE_SELECTOR;\n        let excludeString = Constants.FOCUSABLE_EXCLUDE;\n\n        if (exclude) {\n            excludeString += ', ' + exclude;\n        }\n\n        if (onlyUnmanaged) {\n            excludeString += ', [tabindex=\"-1\"]';\n        }\n\n        const nodes = Array.prototype.slice.apply(rootNode.querySelectorAll(focusableString)) as HTMLElement[];\n        const excludeNodes = Array.prototype.slice.apply(rootNode.querySelectorAll(excludeString)) as HTMLElement[];\n\n        if (!excludeNodes.length) {\n            return nodes;\n        }\n\n        const diff = (a: HTMLElement[], b: HTMLElement[]) => a.filter(element => b.indexOf(element) === -1);\n        return diff(nodes, excludeNodes);\n    }\n\n    public focusInto(rootNode: HTMLElement, up = false, onlyUnmanaged = false): boolean {\n        const focusableElements = this.findFocusableElements(rootNode, null, onlyUnmanaged);\n        const toFocus = up ? last(focusableElements) : focusableElements[0];\n\n        if (toFocus) {\n            toFocus.focus();\n            return true;\n        }\n\n        return false;\n    }\n\n    public findNextFocusableElement(rootNode: HTMLElement, onlyManaged?: boolean | null, backwards?: boolean): HTMLElement | null {\n        const focusable = this.findFocusableElements(rootNode, onlyManaged ? ':not([tabindex=\"-1\"])' : null);\n        let currentIndex: number;\n\n        if (onlyManaged) {\n            currentIndex = findIndex(focusable, el => el.contains(document.activeElement));\n        } else {\n            currentIndex = focusable.indexOf(document.activeElement as HTMLElement);\n        }\n\n        const nextIndex = currentIndex + (backwards ? -1 : 1);\n\n        if (nextIndex < 0 || nextIndex >= focusable.length) {\n            return null;\n        }\n\n        return focusable[nextIndex];\n    }\n\n    public isFocusUnderManagedComponent(rootNode: HTMLElement): boolean {\n        const managedContainers = rootNode.querySelectorAll(`.${ManagedFocusComponent.FOCUS_MANAGED_CLASS}`);\n\n        if (!managedContainers.length) { return false; }\n\n        for (let i = 0; i < managedContainers.length; i++) {\n            if (managedContainers[i].contains(document.activeElement)) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    public findTabbableParent(node: HTMLElement | null, limit: number = 5): HTMLElement | null {\n        let counter = 0;\n\n        while (node && getTabIndex(node) === null && ++counter <= limit) {\n            node = node.parentElement;\n        }\n\n        if (getTabIndex(node) === null) { return null; }\n\n        return node;\n    }\n\n    private onCellFocused(forceBrowserFocus: boolean): void {\n        const event: CellFocusedEvent = {\n            type: Events.EVENT_CELL_FOCUSED,\n            forceBrowserFocus: forceBrowserFocus,\n            rowIndex: null,\n            column: null,\n            floating: null,\n            api: this.gridApi,\n            columnApi: this.columnApi,\n            rowPinned: null,\n            isFullWidthCell: false\n        };\n\n        if (this.focusedCellPosition) {\n            const rowIndex = event.rowIndex = this.focusedCellPosition.rowIndex;\n            const rowPinned = event.rowPinned = this.focusedCellPosition.rowPinned;\n\n            event.column = this.focusedCellPosition.column;\n\n            const rowCon = this.rowRenderer.getRowConByPosition({ rowIndex, rowPinned });\n\n            if (rowCon) {\n                event.isFullWidthCell = rowCon.isFullWidth();\n            }\n        }\n\n        this.eventService.dispatchEvent(event);\n    }\n\n    public focusGridView(column?: Column, backwards?: boolean): boolean {\n        const nextRow = backwards\n            ? this.rowPositionUtils.getLastRow()\n            : this.rowPositionUtils.getFirstRow();\n\n        if (!nextRow) { return false; }\n\n        const { rowIndex, rowPinned } = nextRow;\n        const focusedHeader = this.getFocusedHeader();\n\n        if (!column && focusedHeader) {\n            column = focusedHeader.column as Column;\n        }\n\n        if (rowIndex == null || !column) { return false; }\n\n        this.rowRenderer.ensureCellVisible({ rowIndex, column, rowPinned });\n\n        this.setFocusedCell(rowIndex, column, makeNull(rowPinned), true);\n\n        if (this.rangeController) {\n            const cellPosition = { rowIndex, rowPinned, column };\n            this.rangeController.setRangeToCell(cellPosition);\n        }\n\n        return true;\n    }\n\n    public focusNextGridCoreContainer(backwards: boolean): boolean {\n        if (this.gridCompController.focusNextInnerContainer(backwards)) {\n            return true;\n        }\n\n        if (!backwards) {\n            this.gridCompController.forceFocusOutOfContainer();\n        }\n\n        return false;\n    }\n}\n"]}